<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mishmish Server ğŸŒ¸</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { background: #121212; color: white; text-align: center; font-family: sans-serif; padding: 20px; }
        .note { color: #ff9f43; font-size: 26px; margin: 20px 0; font-weight: bold; }
        .video-wrapper { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 95%; margin: 20px auto; border-radius: 20px; display: none; border: 2px solid #ff9f43; }
        .video-wrapper iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        /* Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ø¯Ø§Ø¦Ù… */
        #permTag { font-size: 12px; color: #2ecc71; display: none; margin-bottom: 10px; }
    </style>
</head>
<body>

    <h1>Mishmish Server ğŸŒ¸</h1>
    <div id="permTag">ğŸ“Œ Ù…Ø­ØªÙˆÙ‰ Ù…Ø«Ø¨Øª</div>
    <div id="noteDisplay" class="note"></div>

    <div id="videoContainer" class="video-wrapper">
        <iframe id="videoPlayer" src="" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
    </div>

    <script>
        const firebaseConfig = { databaseURL: "https://ourphotoshare-a874a-default-rtdb.firebaseio.com" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function checkExpiry(snapshot, path) {
            const data = snapshot.val();
            if (!data || !data.content) return null;

            // Ø¥Ø°Ø§ ÙƒØ§Ù† "Ø¯Ø§Ø¦Ù…" Ù„Ø§ Ù†ÙØ¹Ù„ Ø´ÙŠØ¡
            if (data.permanent) {
                document.getElementById('permTag').style.display = 'block';
                return data.content;
            }

            document.getElementById('permTag').style.display = 'none';
            const oneHour = 60 * 60 * 1000; // Ø³Ø§Ø¹Ø© Ø¨Ø§Ù„Ù…Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©
            const now = Date.now();

            if (now - data.timestamp > oneHour) {
                // Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø³Ø§Ø¹Ø© -> Ø§Ù…Ø³Ø­ Ù…Ù† Ø§Ù„Ø¯Ø§ØªØ§Ø¨ÙŠØ²
                db.ref(path).set(null);
                return "";
            }
            return data.content;
        }

        // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù†Øµ
        db.ref('note').on('value', (s) => {
            const content = checkExpiry(s, 'note');
            document.getElementById('noteDisplay').innerText = content || "";
        });

        // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
        db.ref('video_url').on('value', (s) => {
            const content = checkExpiry(s, 'video_url');
            const container = document.getElementById('videoContainer');
            if (content) {
                let id = content.includes("v=") ? content.split("v=")[1].split("&")[0] : content.split("youtu.be/")[1];
                document.getElementById('videoPlayer').src = `https://www.youtube.com/embed/${id}?autoplay=1`;
                container.style.display = 'block';
            } else {
                container.style.display = 'none';
            }
        });

        // ÙØ­Øµ ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø© Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ù…Ø³Ø­ Ø­ØªÙ‰ Ù„Ùˆ Ø§Ù„ØµÙØ­Ø© Ù…ÙØªÙˆØ­Ø©
        setInterval(() => {
            db.ref('note').once('value', s => checkExpiry(s, 'note'));
            db.ref('video_url').once('value', s => checkExpiry(s, 'video_url'));
        }, 60000);
    </script>
</body>
</html>
