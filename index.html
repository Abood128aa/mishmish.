<script>
    // ... (نفس إعدادات Firebase السابقة) ...

    function react(type) {
        // التحقق إذا كان المستخدم قد صوت مسبقاً لهذا النوع (like أو dislike)
        const hasVoted = localStorage.getItem('voted_' + type);

        if (hasVoted) {
            alert("لقد سجلت إعجابك بالفعل! ✨");
            return; // التوقف هنا وعدم زيادة الرقم في Firebase
        }

        // إذا لم يصوت بعد، نقوم بزيادة الرقم في القاعدة
        db.ref('reactions/' + type).transaction((current) => {
            return (current || 0) + 1;
        }).then(() => {
            // حفظ حالة التصويت في ذاكرة المتصفح لمنع التكرار
            localStorage.setItem('voted_' + type, 'true');
            
            // تغيير لون الأيقونة ليعرف أنه تم التصويت
            document.getElementById('icon-' + type).style.color = "#ff9f43";
        });
    }

    // عند تحميل الصفحة، نتحقق إذا كان قد صوت سابقاً لتلوين الأيقونات
    window.onload = function() {
        if(localStorage.getItem('voted_like')) document.getElementById('icon-like').style.color = "#ff9f43";
        if(localStorage.getItem('voted_dislike')) document.getElementById('icon-dislike').style.color = "#ff9f43";
    };
</script>
