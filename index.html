<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mishmish Space ğŸŒ¸</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root { --accent: #ff9f43; --bg: #121212; --card: #1e1e1e; }
        body { background: var(--bg); color: white; font-family: sans-serif; margin: 0; padding: 20px; text-align: center; }
        
        .main-card { background: var(--card); border-radius: 30px; padding: 25px; max-width: 480px; margin: auto; border: 1px solid #333; box-shadow: 0 15px 35px rgba(0,0,0,0.6); transition: 0.3s; }
        
        .note-text { color: var(--accent); font-size: 26px; font-weight: bold; margin-bottom: 20px; line-height: 1.4; }
        
        #mainImage { max-width: 100%; border-radius: 20px; display: none; margin-bottom: 20px; border: 1px solid #444; }
        
        .video-container { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: 20px; display: none; margin-bottom: 20px; border: 2px solid var(--accent); }
        .video-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; }

        .interaction-bar { display: flex; justify-content: space-around; padding: 20px 0; border-top: 1px solid #333; margin-top: 10px; }
        .btn-act { background: none; border: none; color: #777; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 8px; transition: 0.3s; }
        .btn-act i { font-size: 28px; }
        .btn-act span { font-size: 16px; font-weight: bold; color: #eee; }
        .voted { color: var(--accent) !important; transform: scale(1.1); }
        
        /* ØªØ£Ø«ÙŠØ± Ø§Ù„Ù†Ø¨Ø¶ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ø¯ÙŠØ« */
        .bump { animation: bump 0.3s ease-out; }
        @keyframes bump { 0% { transform: scale(1); } 50% { transform: scale(1.3); } 100% { transform: scale(1); } }

        .comments-section { text-align: right; background: rgba(255,255,255,0.03); border-radius: 20px; padding: 15px; margin-top: 15px; }
        .comment-item { border-bottom: 1px solid #333; padding: 12px 0; font-size: 15px; color: #ddd; }
        .comment-item:last-child { border: none; }
        .reply-tag { color: var(--accent); font-size: 13px; display: block; margin-top: 6px; padding-right: 12px; border-right: 2px solid var(--accent); }
    </style>
</head>
<body>

    <h2 style="color: var(--accent); margin-bottom: 30px;">ğŸŒ¸ MISHMISH SERVER</h2>

    <div class="main-card">
        <div id="noteDisplay" class="note-text">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...</div>

        <img id="mainImage" src="">

        <div id="videoContainer" class="video-container">
            <iframe id="videoPlayer" src="" allowfullscreen></iframe>
        </div>

        <div class="interaction-bar">
            <button class="btn-act" id="btn-like" onclick="react('like')">
                <i class="fas fa-heart" id="icon-like"></i>
                <span id="lk">0</span>
            </button>
            <button class="btn-act" id="btn-dislike" onclick="react('dislike')">
                <i class="fas fa-heart-broken" id="icon-dislike"></i>
                <span id="dk">0</span>
            </button>
            <button class="btn-act">
                <i class="fas fa-comments"></i>
                <span id="cm">0</span>
            </button>
        </div>

        <div id="commentsList" class="comments-section"></div>
    </div>

    <script>
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ
        const firebaseConfig = { databaseURL: "https://ourphotoshare-a874a-default-rtdb.firebaseio.com" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ø¹ Ø£Ù†ÙŠÙ…ÙŠØ´Ù†
        function updateUI(id, val) {
            const el = document.getElementById(id);
            if (el.innerText != val) {
                el.innerText = val;
                el.parentElement.classList.add('bump');
                setTimeout(() => el.parentElement.classList.remove('bump'), 300);
            }
        }

        // 1. Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø© (note)
        db.ref('note').on('value', (s) => {
            const data = s.val();
            document.getElementById('noteDisplay').innerText = data ? (data.content || data) : "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø­ØªÙˆÙ‰ Ø­Ø§Ù„ÙŠØ§Ù‹";
        });

        // 2. Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„ØµÙˆØ±Ø© (main_image)
        db.ref('main_image').on('value', (s) => {
            const url = s.val();
            const img = document.getElementById('mainImage');
            if(url && url.length > 5) { img.src = url; img.style.display = 'block'; }
            else { img.style.display = 'none'; }
        });

        // 3. Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ (video_url)
        db.ref('video_url').on('value', (s) => {
            const url = s.val();
            const container = document.getElementById('videoContainer');
            const player = document.getElementById('videoPlayer');
            if(url && url.length > 5) {
                let id = url.includes("v=") ? url.split("v=")[1].split("&")[0] : url.split("youtu.be/")[1];
                player.src = `https://www.youtube.com/embed/${id}?modestbranding=1&rel=0`;
                container.style.display = 'block';
            } else { container.style.display = 'none'; player.src = ""; }
        });

        // 4. Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„ØªÙØ§Ø¹Ù„Ø§Øª (Ø§Ù„Ù„Ø§ÙŠÙƒ ÙˆØ§Ù„Ø¯ÙŠØ³Ù„Ø§ÙŠÙƒ)
        db.ref('reactions').on('value', (s) => {
            const d = s.val() || {like:0, dislike:0};
            updateUI('lk', d.like || 0);
            updateUI('dk', d.dislike || 0);
        });

        // 5. Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª ÙˆØ§Ù„Ø±Ø¯ÙˆØ¯
        db.ref('comments').on('value', (s) => {
            const list = document.getElementById('commentsList');
            list.innerHTML = "";
            let count = 0;
            s.forEach((child) => {
                count++;
                const c = child.val();
                let html = `<div class="comment-item">ğŸ’¬ ${c.text || c}`;
                if(c.reply) html += `<span class="reply-tag">ğŸ“© Ø±Ø¯ Ø§Ù„Ù…Ø´Ø±Ù: ${c.reply}</span>`;
                html += `</div>`;
                list.innerHTML += html;
            });
            updateUI('cm', count);
        });

        // ÙˆØ¸ÙŠÙØ© Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±
        function react(type) {
            if (localStorage.getItem('voted_' + type)) {
                alert("Ù„Ù‚Ø¯ Ø³Ø¬Ù„Øª Ø±Ø£ÙŠÙƒ Ù…Ø³Ø¨Ù‚Ø§Ù‹! âœ¨");
                return;
            }

            db.ref('reactions/' + type).transaction(c => (c || 0) + 1).then(() => {
                localStorage.setItem('voted_' + type, 'true');
                document.getElementById('icon-' + type).classList.add('voted');
            });
        }

        // ÙØ­Øµ Ø­Ø§Ù„Ø© Ø§Ù„ØªØµÙˆÙŠØª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
        window.onload = () => {
            if(localStorage.getItem('voted_like')) document.getElementById('icon-like').classList.add('voted');
            if(localStorage.getItem('voted_dislike')) document.getElementById('icon-dislike').classList.add('voted');
        };
    </script>
</body>
</html>
